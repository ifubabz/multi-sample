/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.3/userguide/java_library_plugin.html
 */

buildscript {
	ext {
		springBoot = '2.3.2.RELEASE' 
		dependencyManagement = '1.0.9.RELEASE'
	}
	repositories {
		maven {
			url "$repoUrl/openlabs-public/"
		}
	}
}

plugins {
	id 'org.springframework.boot' version "${springBoot}"
	id 'io.spring.dependency-management' version "${dependencyManagement}"
    id 'java-library'
    id 'maven-publish'
}

allprojects {
	group = 'com.openlabs'
	version = '0.0.1-SNAPSHOT'
	sourceCompatibility = '1.8'
}

subprojects {
	apply plugin: 'org.springframework.boot'
	apply plugin: 'io.spring.dependency-management'
	apply plugin: 'java-library'
	apply plugin: 'java'
	apply plugin: 'maven-publish'	
	
	repositories {
		maven {
			url "$repoUrl/openlabs-public/"
        }
	}
	dependencies {
		implementation 'org.springframework.boot:spring-boot-starter'
		implementation 'org.projectlombok:lombok'
		
		annotationProcessor('org.projectlombok:lombok')
		
		testImplementation('org.springframework.boot:spring-boot-starter-test') {
			exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'
			exclude group: 'com.h2database', module: 'h2'
		}
		
		testAnnotationProcessor('org.projectlombok:lombok')
	}

	test {
		useJUnitPlatform()
	}
	
	publishing {
        publications {
			maven(MavenPublication) { 
				groupId = group 
				artifactId = project.name
				version = version 
				artifact("build/libs/$project.name-$version"+".jar") { 
					extension 'jar' 
				} 
			}
		}
		
		repositories {
			maven {
				name 'nexus'
				def releasesRepoUrl = "$repoUrl/maven-releases"
				def snapshotsRepoUrl = "$repoUrl/maven-snapshots"
				url = project.hasProperty('release') ? releasesRepoUrl : snapshotsRepoUrl
				credentials { 
					username project.repoUsername 
					password project.repoPassword
				}
			}
		}
	}
}
